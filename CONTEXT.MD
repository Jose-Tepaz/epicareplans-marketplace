## üåê Descripci√≥n General

El proyecto consiste en el desarrollo de un **ecosistema digital para la venta, gesti√≥n y seguimiento de seguros**, integrando m√∫ltiples aseguradoras mediante APIs (ej. Ameritas, All State, etc.).

El sistema estar√° compuesto por **tres m√≥dulos principales**, todos conectados a una misma base de datos central (Supabase), que permitir√°n una experiencia fluida para usuarios, clientes y equipo interno.

---

## üìã Estado Actual del Proyecto

### ‚úÖ **Funcionalidades Implementadas (Est√°ticas)**
- **Formulario multipasos** en `/explore` - 6 pasos completos
- **P√°gina de resultados** en `/insurance-options` - Muestra planes est√°ticos
- **UI/UX completa** con Next.js, Shadcn, Tailwind CSS

### üîÑ **Funcionalidades Pendientes (Din√°micas)**
- Integraci√≥n con API de All State
- Configuraci√≥n de Supabase
- Autenticaci√≥n con Magic Link
- Carrito de compras
- Checkout y redirecci√≥n

---

## üéØ **Prioridades de Desarrollo**

1. **PRIMERA FASE**: Formulario multipasos + Resultados din√°micos
2. **SEGUNDA FASE**: Integraci√≥n con All State API
3. **TERCERA FASE**: Supabase + Autenticaci√≥n
4. **CUARTA FASE**: Carrito + Checkout

---

## üîß **Stack Tecnol√≥gico**

- **Frontend**: Next.js 14, React, TypeScript
- **UI**: Shadcn/ui, Tailwind CSS
- **Base de Datos**: Supabase (PostgreSQL)
- **Autenticaci√≥n**: Supabase Auth (Magic Link)
- **API Externa**: All State Insurance API

---

## üîë **Credenciales de API**

```bash
# All State API
Authorization: Basic VGVzdFVzZXI6VGVzdDEyMzQ=
agentId: "159208"
```

### üìã **APIs de Aseguradoras**

#### üîç **API de Cotizaci√≥n (All State)**
- **Endpoint**: `https://qa1-ngahservices.ngic.com/QuotingAPI/api/v1/Rate/AllPlans`
- **M√©todo**: POST
- **Datos**: Informaci√≥n del formulario multipasos
- **Estado**: ‚úÖ Documentaci√≥n disponible
- **Uso**: Enviar datos del formulario multipasos para obtener todos los planes disponibles

#### üìù **API de Enrollment (Aseguradoras)**
- **Endpoint**: Para procesar inscripciones/checkout
- **M√©todo**: POST
- **Datos**: Formulario con informaci√≥n completa del usuario
- **Estado**: ‚è≥ Documentaci√≥n pendiente
- **Nota**: Cada aseguradora tendr√° su propio endpoint de enrollment

---

## üìä **Estructura de Base de Datos (Por Definir)**

> **IMPORTANTE**: Toda la estructura de base de datos debe quedar completamente documentada

### Tablas Propuestas:
- `users` - Informaci√≥n de usuarios
- `user_profiles` - Perfiles de seguros de usuarios
- `insurance_requests` - Solicitudes de cotizaci√≥n
- `insurance_plans` - Planes disponibles
- `cart_items` - Items en carrito
- `enrollment_requests` - Solicitudes de enrollment/checkout
- `orders` - √ìrdenes de compra

---

## Importante

Ahora solo trabajaremos con All State, la documentaci√≥n de la api de all state es esta:

## üîπ 1. Sitio Web P√∫blico

### üéØ Objetivo

El objetivo del sitio web es **atraer, educar y convertir visitantes en clientes** mediante un proceso guiado que permite al usuario:

1. Conocer los diferentes tipos de seguros disponibles.
2. Completar un **formulario multipasos (/explore)** para determinar su perfil y elegibilidad, este formulario envia una solicitud a la
3. Crear una cuenta autom√°ticamente (mediante Magic Link).
4. Ver los seguros recomendados con base en su perfil.
5. Agregar uno o varios seguros al carrito.
6. Redirigirse al **checkout** del proveedor correspondiente para completar el pago.

### üß© Funcionalidades Clave

- Cat√°logo de productos conectado a APIs de las aseguradoras.
- Formulario din√°mico de perfil (mulpasos).
- Creaci√≥n de cuenta con Supabase Auth.
- Carrito inteligente que agrupa productos por proveedor.
- Env√≠o autom√°tico de informaci√≥n de compra y perfil al backend.
- Redirecci√≥n al Dashboard de usuario una vez finalizada la compra.

### üß† Rol dentro del ecosistema

El sitio web act√∫a como **canal de adquisici√≥n y registro**, donde inicia el ciclo de vida del cliente.

Toda la informaci√≥n recolectada en este m√≥dulo nutre al **dashboard del usuario** y al **panel interno de gesti√≥n**.

# Servicios

Base de datos: Supabase

API, por ahora solo ALLSTATE:

# Documentaci√≥n de la API

Datos completos que podemos enviar para recibir todos los planes (no es necesario enviar todo)

```json
{
  "agentId": "string",
  "effectiveDate": "2025-10-07T04:03:16.760Z",
  "terminationDate": "2025-10-07T04:03:16.760Z",
  "enrollmentDate": "2025-10-07T04:03:16.760Z",
  "stmTerm": 0,
  "zipCode": "strin",
  "state": "string",
  "applicants": [
    {
      "birthDate": "2025-10-07T04:03:16.760Z",
      "gender": "Male",
      "relationshipType": "None",
      "isSmoker": true,
      "dateLastSmoked": "2025-10-07T04:03:16.760Z",
      "hasPriorCoverage": true,
      "rateTier": "Standard",
      "memberId": "string"
    }
  ],
  "insuranceNetwork": "Undefined",
  "stmRenewalTerms": 0,
  "stmRenewalRateLock": true,
  "isRewrite": true,
  "listBillNumber": "string",
  "productTypes": [
    "Unknown"
  ],
  "paymentFrequency": "None",
  "planTypes": [
    "Unknown"
  ],
  "medSupp": {
    "enrollmentType": "Unknown",
    "medicarePartBEffectiveDate": "2025-10-07T04:03:16.760Z",
    "guaranteedIssueCircumstance": "BirthdayAnniversary",
    "isPreMacraEligible": true,
    "hasHouseholdDiscount": true,
    "householdDiscountType": "None",
    "wearablesDiscount": true,
    "applicationFormNumber": "string"
  },
  "includeAdditionalBenefits": true,
  "includeACABundleDiscounts": true,
  "includeStackableDiscounts": true
}
```

Datos importantes para obtener todos los planes

```jsx
{
	"PlansToRate": null,
	 "ExcludeAvailablePlans": false,
  "agentId": "159208",
  "effectiveDate": "2025-08-25T22:50:17.715Z",
  "zipCode": "07008",
  "applicants": [
    {
      "birthDate": "1994-08-25T22:50:17.715Z",
      "gender": "Male",
      "relationshipType": "Primary",
      "isSmoker": false
    }
  ],
	"paymentFrequency": "Monthly",
	"productTypes": [
   "NHICSupplemental" // para obtener tipos de productos
  ]
	

  
}
```

Si es fumador, necesitamos los siguientes campos adicionales

```json
{
"isSmoker": true,
"dateLastSmoked": "2025-10-07T04:03:16.760Z"
}
```

Si queremos agregar nuevos miembros

```json
"applicants": [
    {
      "birthDate": "2025-10-07T04:03:16.760Z",
      "gender": "Male",
      "relationshipType": "None",
      "isSmoker": true,
      "dateLastSmoked": "2025-10-07T04:03:16.760Z",
      "hasPriorCoverage": true,
      "rateTier": "Standard",
      "memberId": "string"
    }
```

La respuesta que retorna la API es una lista de planes con la siguiente informaci√≥n

```jsx
{
	"ratedPlans": [],
	"availablePlans": [
		{
			"id": "2144",
			"enrollerId": "159208",
			"productCode": "21044",
			"planType": "NICAFB",
			"productType": "NHICSupplemental",
			"planName": "Accident Fixed-Benefit",
			"activeThruDate": "2999-12-31T00:00:00",
			"applicationType": "Individual",
			"issueType": "Guaranteed",
			"productSubCode": 2144,
			"planKey": "2144",
			"paymentFrequency": "Monthly",
			"discounts": [],
			"familyComposition": "Member",
			"isAMERider": false,
			"hasDentalDiscountCard": false,
			"coverageEffectiveDate": "2025-08-25T22:50:17.715Z",
			"coverageTerminationDate": null,
			"coverageEnrolledDate": "2025-08-24T22:50:17.715Z",
			"insuranceNetwork": "Undefined",
			"baseProducts": [
				"AFB_I"
			],
			"baseProductName": null,
			"pathToBrochure": "https://allstatehealth.canto.com/direct/document/arajrcs24944d28vfj22097p4p/bmb78ne6pRgoe0oRhGAAgc7AHYs/original?content-type=application%2Fpdf&name=2024_0125_AHS_AFB_1037-2_BRO.pdf",
			"stmRenewalTerms": null,
			"stmRenewalRateLock": null,
			"insuranceRate": 25.15,
			"standardTierInsuranceRate": 25.15,
			"rate": 25.15,
			"standardTierRate": 25.15,
			"totalRate": 25.15,
			"standardTierTotalRate": 25.15,
			"rateExcludingMultiProductDiscounts": 0,
			"providerLink": "",
			"benefits": [
				{
					"name": "One Time Enrollment Fee",
					"value": 0,
					"premium": 0.00,
					"which": "EnrollmentFee",
					"formattedValue": "$0.00"
				},
				{
					"name": "LIFE Association Membership",
					"value": 0,
					"premium": 0.00,
					"which": "AssociationFee",
					"formattedValue": "$0.00"
				}
			],
			"benefitDescription": "$25,000/$50,000 Benefit",
			"numberOfDays": 0,
			"additionalCoverages": [],
			"memberRates": [],
			"riders": [],
			"isDiscounted": false,
			"productSourceDetail": null,
			"valid": true,
			"enrollmentFeeNumber": 0.00,
			"productRateComponents": [],
			"applicants": [],
			"waiveFee": false,
			"isSeniorPlan": false,
			"carrierName": null
		}
		]
		"additionalPlansToOffer": [],
	"discountedPlansToOffer": [],
	"monthlyPaymentTotal": 0,
	"initialPaymentTotal": 0,
	"enrollmentFeeTotal": 0
	}
		
```

---

## üìù **CHECKLIST DE DESARROLLO**

### üöÄ **FASE 1: Formulario Multipasos + Resultados Din√°micos**

#### ‚úÖ **Formulario Multipasos (/explore)**
- [x] **Paso 1**: Pregunta si tiene cuenta (implementado)
- [x] **Paso 2**: C√≥digo postal (implementado)
- [x] **Paso 3**: Fecha de nacimiento (implementado)
- [x] **Paso 4**: G√©nero (implementado)
- [x] **Paso 5**: Fumador/Tabaco (implementado)
- [x] **Paso 6**: Fecha de inicio de cobertura (implementado)
- [x] **Paso 7**: Frecuencia de pago (implementado)
- [ ] **Validaci√≥n**: Mapear campos del formulario a API de All State
- [ ] **Env√≠o**: Conectar formulario con API para obtener planes reales
- [ ] **Navegaci√≥n**: Redirigir a `/insurance-options` con datos reales

#### üîÑ **P√°gina de Resultados (/insurance-options)**
- [x] **UI**: Dise√±o de tarjetas de seguros (implementado)
- [x] **Filtros**: Filtros por tipo de plan, producto, ordenamiento (implementado)
- [ ] **Datos Din√°micos**: Reemplazar datos est√°ticos con respuesta de API
- [ ] **Carrito**: Implementar funcionalidad de agregar al carrito
- [ ] **Estado**: Manejar estado de planes seleccionados

### üîå **FASE 2: Integraci√≥n con All State API**

#### üì° **Configuraci√≥n de API**
- [ ] **Variables de Entorno**: Configurar credenciales de API
- [ ] **Cliente HTTP**: Crear cliente para consumir API de All State
- [ ] **Tipos TypeScript**: Definir interfaces para request/response
- [ ] **Manejo de Errores**: Implementar manejo de errores de API

#### üîÑ **Endpoints a Implementar**
- [ ] **POST /api/insurance/quote**: Proxy para `https://qa1-ngahservices.ngic.com/QuotingAPI/api/v1/Rate/AllPlans`
- [ ] **GET /api/insurance/plans**: Obtener planes disponibles (cache local)
- [ ] **POST /api/insurance/enrollment**: Procesar inscripci√≥n con API de enrollment
- [ ] **Validaci√≥n**: Validar datos antes de enviar a API de All State

### üóÑÔ∏è **FASE 3: Supabase + Autenticaci√≥n**

#### üèóÔ∏è **Configuraci√≥n de Supabase**
- [ ] **Proyecto**: Crear proyecto en Supabase
- [ ] **Variables de Entorno**: Configurar URL y anon key
- [ ] **Cliente**: Configurar cliente de Supabase

#### üìä **Estructura de Base de Datos**
- [ ] **Tabla `users`**: Informaci√≥n b√°sica de usuarios
- [ ] **Tabla `user_profiles`**: Perfiles de seguros de usuarios
- [ ] **Tabla `insurance_requests`**: Solicitudes de cotizaci√≥n
- [ ] **Tabla `insurance_plans`**: Planes disponibles (cache)
- [ ] **Tabla `cart_items`**: Items en carrito
- [ ] **Tabla `orders`**: √ìrdenes de compra
- [ ] **Documentaci√≥n**: Documentar completamente la estructura

#### üîê **Autenticaci√≥n**
- [ ] **Magic Link**: Configurar autenticaci√≥n sin contrase√±a
- [ ] **Middleware**: Proteger rutas que requieren autenticaci√≥n
- [ ] **Context**: Crear contexto de autenticaci√≥n
- [ ] **Redirecci√≥n**: Manejar flujo de login/logout

### üõí **FASE 4: Carrito + Checkout**

#### üõí **Carrito de Compras**
- [ ] **Estado Global**: Implementar estado del carrito (Context/Redux)
- [ ] **Agregar Items**: Funcionalidad para agregar planes al carrito
- [ ] **Eliminar Items**: Funcionalidad para remover planes
- [ ] **Persistencia**: Guardar carrito en localStorage/Supabase
- [ ] **Validaci√≥n**: Validar disponibilidad de planes

#### üí≥ **Checkout**
- [ ] **Resumen**: Mostrar resumen de compra
- [ ] **Formulario de Enrollment**: Formulario completo para API de enrollment
- [ ] **API de Enrollment**: Integrar con endpoint de enrollment de aseguradoras
- [ ] **Redirecci√≥n**: Redirigir a checkout de aseguradora correspondiente
- [ ] **Tracking**: Implementar tracking de conversiones
- [ ] **Confirmaci√≥n**: P√°gina de confirmaci√≥n post-compra

### üß™ **FASE 5: Testing y Optimizaci√≥n**

#### üß™ **Testing**
- [ ] **Unit Tests**: Tests para componentes principales
- [ ] **Integration Tests**: Tests para flujo completo
- [ ] **API Tests**: Tests para integraci√≥n con All State
- [ ] **E2E Tests**: Tests end-to-end del flujo de usuario

#### ‚ö° **Optimizaci√≥n**
- [ ] **Performance**: Optimizar carga de im√°genes y componentes
- [ ] **SEO**: Implementar meta tags y sitemap
- [ ] **Analytics**: Configurar Google Analytics
- [ ] **Error Monitoring**: Implementar Sentry o similar

### üìö **DOCUMENTACI√ìN**

#### üìñ **Documentaci√≥n T√©cnica**
- [ ] **README**: Documentar setup y deployment
- [ ] **API Docs**: Documentar endpoints internos
- [ ] **DB Schema**: Documentar estructura de base de datos
- [ ] **Deployment**: Documentar proceso de deployment

#### üìã **Documentaci√≥n de Usuario**
- [ ] **User Guide**: Gu√≠a de usuario para el formulario
- [ ] **FAQ**: Preguntas frecuentes
- [ ] **Support**: Documentaci√≥n de soporte

---

## üéØ **PR√ìXIMOS PASOS INMEDIATOS**

1. **Revisar formulario actual** y mapear campos a API de All State ‚úÖ
2. **Configurar variables de entorno** para API de All State
3. **Crear endpoint proxy** `/api/insurance/quote` para `https://qa1-ngahservices.ngic.com/QuotingAPI/api/v1/Rate/AllPlans`
4. **Conectar formulario** con API para obtener planes reales
5. **Actualizar p√°gina de resultados** con datos din√°micos

---

## üìû **Contacto y Soporte**

Para dudas sobre el proyecto o la API de All State, consultar este documento o contactar al equipo de desarrollo.